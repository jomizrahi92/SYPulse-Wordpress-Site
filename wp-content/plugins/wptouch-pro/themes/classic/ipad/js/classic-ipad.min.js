var WPtouchWebApp=navigator.standalone;var addToHomeConfig={startDelay:550,lifespan:1000*60,expire:60*24*WPtouch.expiryDays,animationIn:"drop",animationOut:"bubble",touchIcon:true,message:WPtouch.add2home_message};if(window.top!=window.self){window.top.location=self.location.href}if(typeof ontouchstart!="undefined"&&typeof ontouchend!="undefined"){var touchStartOrClick="touchstart";var touchEndOrClick="touchend"}else{var touchStartOrClick="click";var touchEndOrClick="click"}function doClassiciPadReady(){if(hasFixedPos()){var g=jQuery("#wptouch-header, #logo-area, .popover header");g.bind("touchmove",function(l){l.preventDefault()})}else{document.addEventListener("touchmove",function(l){l.preventDefault()},false);var d=jQuery("select, input, textarea");d.bind(touchStartOrClick,function(l){l.stopPropagation()})}window.addEventListener("orientationchange",function(){classicUpdateOrientation()});jQuery(".head-left").find("div.menubar-button").bind(touchEndOrClick,function(){var m="#pop-"+jQuery(this).attr("id");var l=jQuery(this).offset();jQuery(m).css({top:"40px",left:l.left+"px"}).popOverToggle();jQuery(m+" .menu-pointer-arrow").css("left","20px");headerDismissSpan();scrollerRefresh()});jQuery(".head-right").find("div.menubar-button").bind(touchEndOrClick,function(){var m="#pop-"+jQuery(this).attr("id");var l=jQuery(this).offset();jQuery(m).css({top:"40px",left:l.left-jQuery(m).width()/1.45}).popOverToggle();jQuery(m+" .menu-pointer-arrow").css("right","58px");headerDismissSpan();scrollerRefresh()});if(!hasFixedPos()){jQuery(".head-center h1").bind(touchStartOrClick,function(){var l=jQuery("#iscroll-wrapper").data("scroller");l.scrollTo(0,0,500)})}jQuery(function(){var l=jQuery("#pop-blog > div");var m=jQuery("ul.menu-tabs").find("a");m.bind(touchStartOrClick,function(n){l.hide().filter(this.rel).show();m.removeClass("selected");jQuery(this).addClass("selected");n.preventDefault();scrollerRefresh()}).filter(":first").trigger(touchStartOrClick)});jQuery("#popovers-container .pop-inner li a, #pages-wrapper a").live("click",function(){jQuery(this).parent().toggleClass("highlight")});var b=".wptouch-button, .content a, .title-area a, .footer a, ol.commentlist a";jQuery(b).live(touchStartOrClick,function(){jQuery(this).addClass("active")}).live(touchEndOrClick,function(){jQuery(this).removeClass("active")});jQuery("#pages-wrapper").find("li.has_children ul").hide();jQuery("#pages-wrapper ul li.has_children > a").unbind("click").bind("click",function(){jQuery(this).next().webkitSlideToggle(350);jQuery(this).toggleClass("arrow-toggle");jQuery(this).parent().toggleClass("open-tree");scrollerRefresh();return false});jQuery("a.share-post").unbind("click").bind("click",function(){var l=jQuery(this).offset();jQuery("#share-popover").css({top:l.top-260+"px",left:l.left-25+"px",}).fadeIn(350);headerDismissSpan();return false});jQuery("#respond").detach().appendTo(".comment-reply-box .pop-inner").css("display","block");jQuery("#share-placeholder").detach().appendTo("#share-popover").css("display","block");jQuery(".leave-a-comment, span.comments-close-button").unbind("click").bind("click",function(){jQuery(".comment-reply-box").toggleClass("fly-in").flyInToggle();jQuery("input#comment_parent").val("0");jQuery("#box-head h3").html(WPtouch.leave_a_comment);jQuery("#peek").hide();jQuery("#container1 textarea").removeClass("reply");jQuery("#commentform input, #commentform textarea").blur();return false});jQuery("#peek").unbind("click").bind("click",function(){jQuery("#container1").toggleClass("slide");jQuery("#container2").toggleClass("slide2");return false});jQuery("a.comment-reply-login, a.reply-to-comment").unbind("click").bind(touchStartOrClick,function(){jQuery("#account.menubar-button").trigger(touchEndOrClick);return false});if(jQuery(".post").length){jQuery(".content img, .content .wp-caption").each(function(){if(jQuery(this).width()>=350){jQuery(this).addClass("aligncenter")}})}if(!hasFixedPos()){jQuery("textarea, form#prowl-direct-message input, form#loginform input, .content input").bind("blur",function(){scrollTo(0,0,100)})}jQuery("li#instapaper").find("a").click(function(){var m=prompt(WPtouch.instapaper_username,"");if(m){var l=prompt(WPtouch.instapaper_password,"");if(!l){l="default"}var n={url:document.location.href,username:m,password:l,title:document.title};WPtouchAjax("instapaper",n,function(o){if(o=="1"){alert(WPtouch.instapaper_saved);jQuery("#share-popover").fadeOut(350)}else{alert(WPtouch.instapaper_try_again)}})}return false});var a=document.location;var k=jQuery("#container1 textarea");var j={beforeSubmit:function(){jQuery("#container1").append('<div id="comment-spinner"></div>')},success:function(){jQuery("ol.commentlist").load(a+" ol.commentlist > li",function(){jQuery("#comment-spinner").remove();k.addClass("success");commentReplyLinks()});setTimeout(function(){jQuery(".comments-close-button").trigger("click");k.removeClass("success");scrollerRefresh()},1500)},error:function(){jQuery("#comment-spinner").remove();k.addClass("error");jQuery("#container1").prepend('<div id="error-text">'+WPtouch.comment_failure+"</div>");setTimeout(function(){k.removeClass("error");jQuery("#error-text").remove()},3000)},resetForm:true,timeout:7500};if(jQuery.isFunction(jQuery.fn.ajaxForm)){jQuery("#commentform").ajaxForm(j)}var h=jQuery("#prowl-direct-message textarea");var e={beforeSubmit:function i(o,n,l){for(var m=0;m<o.length;m++){if(!o[m].value){alert(WPtouch.validation_message);return false}jQuery("#prowl-direct-message").find("p").prepend('<div id="prowl-spinner"></div>')}},success:function(){jQuery("#prowl-spinner").remove();h.addClass("success");setTimeout(function(){jQuery("#message").trigger(touchEndOrClick);h.removeClass("success")},1000)},error:function(){jQuery("#prowl-spinner").remove();h.addClass("error");jQuery("#prowl-direct-message").prepend('<div id="prowl-error-text">'+WPtouch.prowl_failure+"</div>");setTimeout(function(){h.removeClass("error");jQuery("#prowl-error-text").remove()},4000)},resetForm:true,timeout:3500};if(jQuery.isFunction(jQuery.fn.ajaxForm)){jQuery("#prowl-direct-message").ajaxForm(e)}jQuery(window).load(function(){var l=jQuery("#welcome-message");if(l.length){l.show()}setTimeout(function(){scrollerRefresh()},0)});jQuery(function(){var l=1;jQuery("input, select, textarea").each(function(){if(this.type!="hidden"){var m=jQuery(this);m.attr("tabindex",l);l++}})});var f=WPtouch.toggle_on;jQuery(".on").text(f);var c=WPtouch.toggle_off;jQuery(".off").text(c);jQuery("#switch").find("div").bind(touchEndOrClick,function(){var l=jQuery(this).attr("title");jQuery(".on").toggleClass("active");jQuery(".off").toggleClass("active");setTimeout(function(){window.location=l},500);return false});classicUpdateOrientation();loadMoreEntries();commentReplyLinks();loadMoreComments();welcomeMessage();webAppLinks();webAppOnly();setupScrolls();classicHandleShortcodes()}function setupScrolls(){if(!hasFixedPos()){jQuery(".iscroller").each(function(){var a=jQuery(this).attr("id");activeScroller=new iScroll(a);jQuery(this).data("scroller",activeScroller)})}}function scrollerRefresh(){if(!hasFixedPos()){var b=jQuery(".iscroller").filter(":visible").data("scroller");var a=jQuery("#iscroll-wrapper").data("scroller");setTimeout(function(){b.refresh();a.refresh()},0)}else{return true}}function classicUpdateOrientation(){var d=jQuery(window).height()-44;var a=jQuery("#logo-area").height();var c=d-a;var b=WPtouchReadCookie("wptouch-ipad-orientation");switch(window.orientation){case 0:case 180:jQuery("body").removeClass("landscape").addClass("portrait");jQuery("#iscroll-wrapper").css("height",d);jQuery("#main-menu #pages-wrapper").detach().appendTo("#pop-menu .pop-inner").css("height","auto").css("max-height","500px");jQuery(".popover.open").each(function(){jQuery(this).removeClass("open").hide()});WPtouchCreateCookie("wptouch-ipad-orientation","portrait",365);handleVids();break;case 90:case -90:default:jQuery("body").removeClass("portrait").addClass("landscape");jQuery("#iscroll-wrapper").css("height",d);jQuery("#pages-wrapper").detach().css("height",c).css("max-height","none").appendTo("#main-menu");jQuery(".popover.open").each(function(){jQuery(this).removeClass("open").hide()});WPtouchCreateCookie("wptouch-ipad-orientation","landscape",365);handleVids()}if(!hasFixedPos()){setTimeout(function(){var e=jQuery("#iscroll-wrapper").data("scroller");e.refresh()},550)}}function headerDismissSpan(){if(!jQuery("#dismiss-underlay").length){jQuery("body").append('<span id="dismiss-underlay"></span>');jQuery("#dismiss-underlay").bind(touchStartOrClick,function(a){jQuery(this).remove();jQuery("#popovers-container .popover.open").removeClass("open").fadeOut(350);jQuery("#share-popover").fadeOut(350);return false})}else{jQuery("#dismiss-underlay").remove()}}function classicHandleShortcodes(){if(WPtouchWebApp){var a=jQuery(".wptouch-shortcode-webapp-only");if(a.length){a.show()}}}function loadMoreEntries(){var a=jQuery("a.load-more-link");var b=".ajax-page-target";if(a.length){a.unbind("click").live("click",function(){jQuery("a.load-more-link span").addClass("ajax-spinner");var c=jQuery(this).attr("href");jQuery("#content").append("<div class='ajax-page-target'></div>");jQuery(b).hide().load(c+" #content .post, #content .load-more-link",function(){jQuery(this).replaceWith(jQuery(this).html());jQuery("span.ajax-spinner").parent().fadeOut(350);webAppLinks();scrollerRefresh();handleVids()});return false})}}function loadMoreComments(){var a=jQuery("ol.commentlist li.load-more-comments-link a");if(a.length){a.unbind("click").live("click",function(){var b=jQuery(this).attr("href");jQuery(this).addClass("ajax-spinner").delay(1250).fadeOut(350);jQuery("ol.commentlist").append("<div class='ajax-page-target'></div>");jQuery("div.ajax-page-target").hide().load(b+" ol.commentlist > li",function(){jQuery(this).replaceWith(jQuery(this).html());commentReplyLinks();webAppLinks();scrollerRefresh()});return false})}}function commentReplyLinks(){jQuery(".commentlist a.comment-reply-link").bind(touchStartOrClick,function(){var a=jQuery(this).closest("li.comment").attr("ID");var b=jQuery("#"+a).find("span.fn:first").text();var d=jQuery(".commentlist ol").attr("ID");var c=jQuery("li#"+a+" .comment-content:first > p").text();jQuery(".comment-reply-box").addClass("fly-in").flyInToggle();jQuery("#box-head h3").html(WPtouch.leave_a_reply+" <span>"+b+"</span>");jQuery("#peek").show();jQuery("input#comment_parent").val(a);jQuery("#container1 textarea").addClass("reply");jQuery("#container2").html(c);return false})}function webAppLinks(){if(WPtouchWebApp){var a=jQuery("a").not(".no-ajax, .email a, .wptouch-button, .comment-buttons a, ul.menu-tabs a, #pages-wrapper .has_children > a, a.load-more-link, .load-more-comments-link a, #share-popover a, .GTTabs a");a.each(function(){var f=jQuery(this).attr("href");var d=jQuery(this);var c=location.protocol+"//"+location.hostname;var b=location.hostname.split(".");var e=b[1]+"."+b[2];if(typeof wptouch_ignored_urls!="undefined"){jQuery.each(wptouch_ignored_urls,function(g,h){if(f.match(h)){d.addClass("ignored")}})}if(f.match((/[^\s]+(\.(pdf|numbers|pages|xls|xlsx|doc|docx|zip|tar|gz|csv|txt))$/i))){d.addClass("external")}else{if(f.match((/[^\s]+(\.(jpg|jpeg|gif|png|bmp|tiff))$/i))){d.addClass("img-link")}}jQuery(d).unbind("click").bind("click",function(g){if(jQuery(d).hasClass("external")||jQuery(d).parent("li").hasClass("external")){confirmForExternal=confirm(WPtouch.external_link_text+" \n"+WPtouch.open_browser_text);if(confirmForExternal){return true}else{g.preventDefault();g.stopImmediatePropagation()}}else{if(jQuery(d).hasClass("img-link")){return false}else{if(f.match(c)||!f.match("http://")){if(jQuery(d).hasClass("ignored")||jQuery(d).parent("li").hasClass("ignored")){confirmForExternal=confirm(WPtouch.wptouch_ignored_text+" \n"+WPtouch.open_browser_text);if(confirmForExternal){return true}else{return false}}else{WPtouchCreateCookie("wptouch-load-last-url",f,365);window.location=f;g.preventDefault()}}else{confirmForExternal=confirm(WPtouch.external_link_text+" \n"+WPtouch.open_browser_text);if(confirmForExternal){return true}else{return false}}}}})})}else{jQuery("li.target a").attr("target","_blank")}}function webAppOnly(){if(WPtouchWebApp){var a=jQuery("body.loadsaved").length;jQuery("body").addClass("web-app");jQuery("#account-link-area, #switch, #welcome-message").remove();if(!a){WPtouchEraseCookie("wptouch-load-last-url")}jQuery(".post a").has("img").each(function(){jQuery(this).click(function(c){var b=jQuery(this).attr("href");if(b.match(".jpg")||b.match(".png")||b.match(".jpeg")||b.match(".gif")){c.preventDefault();c.stopImmediatePropagation()}})})}}function welcomeMessage(){if(!WPtouchWebApp){jQuery("a#close-msg").unbind("click").bind("click",function(){WPtouchCreateCookie("wptouch_welcome","1",365);jQuery("#welcome-message").fadeOut(350);return false})}}jQuery.fn.popOverToggle=function(){if(!this.hasClass("open")){this.show().addClass("open")}else{this.removeClass("open").fadeOut(350)}};jQuery.fn.flyInToggle=function(){if(this.hasClass("fly-in")){this.viewportCenter().css("-webkit-transform","scale(1)").css("opacity","1").css("-webkit-transition","350ms")}else{this.viewportCenter().css("-webkit-transform","scale(0)").css("opacity","0").css("-webkit-transition","350ms")}};jQuery.fn.viewportCenter=function(){this.css("position","absolute");this.css("top",((jQuery(window).height()-this.outerHeight())/2)+jQuery(window).scrollTop()+"px");this.css("left",((jQuery(window).width()-this.outerWidth())/2)+jQuery(window).scrollLeft()+"px");this.show();return this};jQuery.fn.webkitSlideToggle=function(){if(!this.hasClass("slide-in")){this.show().addClass("slide-in")}else{this.slideUp(350).removeClass("slide-in")}};function handleVids(){if(jQuery.isFunction(jQuery.fn.fitVids)){jQuery(".content").fitVids()}if(typeof window.coyierVids=="function"){coyierVids()}if(jQuery("video").length){jQuery("video").attr("controls","controls")}}function hasFixedPos(){return"-webkit-overflow-scrolling" in document.body.style}function WPtouchCreateCookie(c,d,e){if(e){var b=new Date();b.setTime(b.getTime()+(e*24*60*60*1000));var a="; expires="+b.toGMTString()}else{var a=""}document.cookie=c+"="+d+a+"; path="+WPtouch.siteurl}function WPtouchReadCookie(b){var e=b+"=";var a=document.cookie.split(";");for(var d=0;d<a.length;d++){var f=a[d];while(f.charAt(0)==" "){f=f.substring(1,f.length)}if(f.indexOf(e)==0){return f.substring(e.length,f.length)}}return null}function WPtouchEraseCookie(a){WPtouchCreateCookie(a,"",-1)}jQuery(document).ready(function(){doClassiciPadReady()});